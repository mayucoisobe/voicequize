# Voice de Quize
### 🧒🏻👦🏻 3~5歳児を対象にした、声で答えるクイズ形式の知育アプリです。カラフルなブロックをクリックするたびに、パズルのように隠れている画像の一部が見えてきます。画像が何かを想像し、声に出して答えるクイズアプリです。
  
<img width="686" alt="スクリーンショット 2023-07-09 1 12 15" src="https://github.com/mayucoisobe/voicequize/assets/121940353/2119c4b3-6555-4f75-b8d1-71177250dfda">

## 背景・目的

3 歳になったばかりの甥っ子に久しぶりに会った際、身近なものや大好きな車の名前をどんどん話すようになった姿を見て、子供が遊び感覚で使える知育アプリが作れないかと考えたことがキッカケです。

まだ舌足らずながらもとにかく話すのが楽しい！という様子だったので『声』をキーワードにしたアプリを検討、身近なものを見て声に出して答えるクイズを制作しました。

楽しく遊びながら想像力を育み、同時に話すことの楽しさや自分の声がリアルタイムにテキスト（ひらがな）となり表示されることで、文字にも親しみを持つ機会になればいいなと考えました。

## 🃏 概要

 はじめにユーザー側でマイクのアクセスを許可にすること
- スタートボタンを押すと、ゲーム開始（クイズはランダムにシャッフル）
- ブロックをクリックすると、画像が見えてくる、同時にスコアも減っていく
- 何の画像かわかった時点でマイクボタンをクリックして答える
- 声がテキスト化され表示された後、正解不正解の判定を実行
- 正解したら拍手喝采の音声、カードとスコアをゲット！
- 不正解の場合はゲームに戻って続きを行う
- わからない場合(pass)はお手上げボタンで次のクイズへ
- マイカードページでは正解したクイズののカードが溜まっていき、カードをクリックすると日本語と英語でモノの名前が読み上げれる
- PC 環境では、ユーザーが回答した際の声が録音され、マイカードのページで再生される仕組み
- リセットボタンでデータリセット可能

## 🚀 画面構成　

https://www.figma.com/file/c4FfpzY2HVhSCwiZw5uuND/voice_quiz_color1?type=design&node-id=166-508&mode=design&t=HlbgQDNnhIso1hLA-4


## 技術スタック
React/Next.js で構築しました。ホスティングは Vercel を利用し、PWA 対応しました。
状態管理には Zstand を採用し、CSS フレームワークは Tailwind CSS を使っています。

メイン機能である音声データの取り扱いには[Web Speech API](https://developer.mozilla.org/ja/docs/Web/API/Web_Speech_API) を利用し、音声認識 (SpeechRecognitionAPI)及び、音声合成(SpeechSynthesisAPI)でテキスト読み上げを実装しています。

ユーザーの音声データを保存する方法として、Firebase 等のプラットフォームは本アプリにはオーバースペックと考え、ローカルで保存する方法として IndexedDB を利用しました。

また、音声データがテキストに変換される際には漢字混合となるため、ひらがな化 API を利用しひらがなに変換してから表示させています。

---

**UI ライブラリ**

- React

**フロントエンドフレームワーク**

- Next.js 13.2.4

**音声関連ライブラリ**

- [react-speech-recognition](https://www.npmjs.com/package/react-speech-recognition)(音声認識）
- [react-media-recorder](https://www.npmjs.com/package/react-media-recorder)(音声録音）

**状態管理ライブラリ**

- Zustand

**ホスティングサービス**

- Vercel

**データ管理**

- LocalStorage

**IndexedDB ライブラリ(ユーザー音声の保存)**

- [Dexie.js](https://www.npmjs.com/package/dexie)

**CSS フレームワーク・アニメーションライブラリ**

- Tailwind CSS
- GSAP
- Framer-motion

**利用 API**

- ひらがな化 API


#### 工夫したポイント

> 操作しやすいインターフェース

- シンプルな画面構成にし、子供にも操作しやすいよう、ブロックやボタン等に立体感を出すなどの視覚的効果をつけ、認識しやすくしました。

- 動きをつけたり音声でユーザのアクションを促すようにしました。

> インタラクティブな動きでユーザーへ楽しみを提供

- クリックで音声やアニメーションが発生、声が文字となってオンタイムで表示される、などユーザーのアクションに合わせた仕掛けを作り、もっと遊んでいたくなるような仕様を心がけました。

> 音声認識からのテキスト変換~判定までの一連の各実行タイミングの調整

- 音声認識後、即判定実行~モーダル表示となる場合、不自然なスピード感でクイズが進んでいたため
  状態管理を使って実行タイミングやテキスト表示の時間の微調整を行い、ユーザーがゲームの進行を認識しながら画面遷移するように改善しました。

  また、ひらがな化する API はすべての音声データを変換させるとアクセス過多になってしまったため、漢字が含有しているデータのみ抽出した上で、 API へのアクセスを必要最小限にしました。

#### 苦労したポイント

> デプロイ後の SP 環境での不具合が多発

- **メイン機能である音声認識が SP 環境で実行されない**

  グローバルな状態管理している音声データが SP 環境で途中で消えてしまっていることが要因。コードを一部書き換えつつ実行されるか実証を重ね、chorme では認識可能に。

- **音声認識と同時に音声録音を試みるも、SP 環境で実行されず**

  "react-speech-recognition" "react-media-recorder"のいずれか一つの機能のみしか実行されず。
  別のライブラリなどでも実行を試みるもいずれも解決に至らず、音声認識しながらの同時録音に何かしらの制約があるよう?だが、解決できず。
  PC 環境のみユーザー音声での録音・再生とし、SP 環境ではテキストを保存し SpeechSynthesisAPI で読み上げることで対応しました。

- **iOS で一部の音声が再生されない事象**

  iOS の自動再生への制限で基本的には音声再生にはユーザー任意のアクションが必須となっていたため、
  レンダリング時に全ての音を生成し load させ、音声状態管理。任意のタイミングで状態管理させた音声を再生することで対応しました。

  ただし、音声の再生はユーザビリティの面からもユーザーがコントロールできるべきだと認識したため、音声の有無はユーザー側で選択できるようデフォルトではミュートとし、音の切替ボタンを追加しました。

#### 実機チェック

- PC chrome
- PC Safari 15.5-
- Android chrome
- iOS chrome


#### フィードバック

友人と甥っ子に利用してもらいました。

友人からは操作性に関して意見をもらい、次のクイズへの遷移のタイミングやクイズをスキップするボタン設置等、フィードバックを反映させました。

甥については、何度か一緒に遊んだ後で遊び方を理解してくれたようで、楽しんで遊んでくれました。
特に受けが良かったのはクリックで音が鳴ってブロックが消える、声が出るなどのインタラクティブな動き、スコアページのアニメーションでした。

ひらながはまだ読めないこともあってか、ほぼ興味を示さず・・・他には、マイクのボタンが実行中かどうかがわかりにくようで、また、操作のスピードに対して時間切れになるタイミングが少し早すぎような印象を受けたので、まだまだ改善点があると感じました。

実際にユーザーに使ってもらい意見をもらうことは、自身が見えていなかった視点を知る上でも重要だと実感しました。

#### まとめ

ローカル環境での PC ブラウザ上では想定通りに動いており安心していたため、デプロイ後の SP 実機確認での主要機能の不具合頻発にはかなり心が折れました・・・修正にかなりの時間を費やすことになりました。

勢いで構築スタート + 思いつきで仕様を追加（ユーザー音声の録音）した結果、エラーや不具合の対応に想像以上の時間を使うことになりました。
本来は設計時点での技術選定にもっと気を配るべきというアドバイスをいただきその通りだなと痛感しました。

ですが、トライ&エラーの過程での学びが非常に多く、無事公開までたどり着き、初アプリ制作はとても実りある体験となりました！

終わり。


#### Links

- [**Voice de Quize**](https://voicequize.vercel.app/)
- [**Portfolio**](https://mimivel-dev.vercel.app/)




